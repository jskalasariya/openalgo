# Expiry Blast Strategy Configuration
# This file defines all configurable parameters for the expiry blast strategy

# API Configuration
api:
  key: your_openalgo_api_key
  host: http://127.0.0.1:5000

# Strategy Parameters
strategy:
  # Underlying asset - can be NIFTY, SENSEX, BANKNIFTY, FINNIFTY, etc.
  underlying: "NIFTY"
  
  # Underlying exchange - NSE_INDEX for indices, NSE for stocks
  underlying_exchange: "NSE_INDEX"
  
  # Options exchange
  option_exchange: "NFO"
  
  # Time zone
  timezone: "Asia/Kolkata"
  
  # Only run on expiry day (True/False)
  run_only_on_expiry_day: true
  
  # TEST MODE: Set to true to simulate all strategy logic WITHOUT placing actual orders
  # Perfect for backtesting over multiple expiries before going live
  # When true: All entries/exits tracked in DB, but NO orders sent to broker
  test_mode: false
  
  # RUN IMMEDIATELY ON STARTUP: Set to true to execute strategy immediately (bypass scheduler)
  # Useful for testing/debugging without waiting for scheduled time
  # When true: Strategy runs now, then scheduler continues for future scheduled runs
  run_immediately_on_startup: true

# Scheduling
schedule:
  # Start time in IST (24-hour format)
  start_hour: 09
  start_minute: 30
  
  # End time in IST (when to stop monitoring)
  end_hour: 15
  end_minute: 30
  
  # Check interval in seconds
  check_interval_seconds: 5

# Monitoring Parameters
monitoring:
  # Candle interval for breakout analysis (e.g., "1m", "3m", "5m", "15m")
  candle_interval: "3m"
  
  # Number of lookback candles to analyze
  lookback_candles: 5
  
  # Breakout threshold (additional % above highest high, 0 means breakout at highest high)
  breakout_threshold_pct: 0.15

# Position Management
position:
  # Entry quantity per leg (CE and PE)
  entry_quantity: 75
  
  # Lot multiplier - quantity will be multiplied by this value
  # Final quantity = entry_quantity * lot_multiplier
  # Example: entry_quantity=75, lot_multiplier=2 → final quantity = 150
  lot_multiplier: 2
  
  # Initial stop loss as percentage of entry price (0.50 = 50%)
  initial_stop_pct: 0.30
  
  # Trailing stop increment per move (0.01 = 1%)
  trail_step_pct: 0.01
  
  # Profit target as percentage of entry price (1.00 = 100%)
  profit_target_pct: 1.50
  
  # ATM check interval - re-check ATM every N candles to see if it has changed
  atm_recheck_interval: 5
  
  # Move SL to Cost Feature
  # Enable moving stop loss to entry price + offset once profit reaches threshold
  move_sl_to_cost_enabled: true
  
  # Profit threshold to trigger move SL to cost (0.10 = 10%)
  # When profit reaches this percentage, SL will be moved to entry + sl_cost_offset_pct
  move_sl_profit_threshold_pct: 0.30
  
  # Offset to add to entry price when moving SL to cost (0.02 = 2%)
  # Example: Entry at 100, sl_cost_offset_pct=0.02 → SL moves to 102 (cost + 2%)
  sl_cost_offset_pct: 0.02
  
  # Profit Trailing Feature
  # Enable trailing profit target - moves profit target as profit increases
  profit_trailing_enabled: true
  
  # Profit step for trailing (0.05 = 5%)
  # For every profit_trailing_step_pct profit, profit target moves by profit_trailing_increment_pct
  profit_trailing_step_pct: 0.02
  
  # Profit target increment per step (0.01 = 1%)
  # Example: Every 5% profit move, target moves up by 1%
  profit_trailing_increment_pct: 0.01

# Order Configuration
orders:
  # Auto place orders (False = dry run mode, True = live trading)
  auto_place_orders: true
  
  # Instrument type for API calls ("options" for options trading)
  instrument_type: "options"
  
  # Price type - "MARKET" or "LIMIT"
  price_type: "MARKET"
  
  # Product type - "NRML" (normal), "MIS" (margin intraday square-off), etc.
  product: "NRML"
  
  # Action type for entry - "BUY" or "SELL"
  entry_action: "BUY"
  
  # Action type for exit - "SELL" for BUY positions, "BUY" for SHORT positions
  exit_action: "SELL"

# Logging
logging:
  # Print quotes immediately after fetching
  print_quotes_immediately: true
  
  # Print candle data
  print_candle_data: true
  
  # Print position updates
  print_position_updates: true
  
  # Log file path (optional, empty string = no file logging)
  log_file_path: ""

# ATM Change Handling
atm_monitoring:
  # Enable monitoring for ATM changes during the day
  monitor_atm_changes: true
  
  # ATM check interval in minutes (check if ATM has changed every N minutes)
  atm_check_interval_minutes: 3
  
  # Close positions if ATM changes (True = exit and re-enter with new ATM)
  close_on_atm_change: true
  
  # ATM strike change buffer (in index points)
  # Only trigger ATM change if underlying moves beyond this buffer from current strike
  # Example: For NIFTY strike 26250, if buffer=20:
  #   - ATM change triggered only if underlying > 26270 or < 26230
  #   - Prevents frequent resets when price hovers near strike boundary
  # Recommended: 20-50 for NIFTY, 50-100 for BANKNIFTY, 100-200 for SENSEX
  atm_strike_change_buffer: 20

# Leg Specifications
legs:
  # Monitor both CE and PE or only one
  monitor_ce: true
  monitor_pe: true
  
  # If monitoring only one leg, specify which one
  single_leg_type: null  # "CE" or "PE" or null for both
  
  # Strike selection for CE leg
  # Options: "ATM" (at-the-money), "ITM1"-"ITM5" (in-the-money), "OTM1"-"OTM5" (out-of-the-money)
  # Example: "ATM" = strike closest to spot, "ITM1" = 1 strike in-the-money, "OTM1" = 1 strike out-of-the-money
  ce_strike_selection: "ATM"
  
  # Strike selection for PE leg
  # Options: "ATM" (at-the-money), "ITM1"-"ITM5" (in-the-money), "OTM1"-"OTM5" (out-of-the-money)
  # Example: "ATM" = strike closest to spot, "ITM1" = 1 strike in-the-money, "OTM1" = 1 strike out-of-the-money
  pe_strike_selection: "ATM"

# WebSocket Configuration (Real-time LTP Streaming)
websocket:
  # Enable WebSocket for real-time LTP updates (much faster than polling)
  # If disabled or connection fails, strategy automatically falls back to REST API polling
  enabled: true
  
  # WebSocket server URL
  # Default: ws://127.0.0.1:8765
  # For remote servers: ws://your-server-ip:8765
  url: "ws://127.0.0.1:8765"
  
  # Connection timeout in seconds
  timeout_seconds: 10
  
  # Reconnection interval in seconds (if connection drops)
  reconnect_interval_seconds: 5
